<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics Dashboard â€” Portfolio Insights</title>
<link rel="stylesheet" href="styles.css">
<style>
  body { padding: 0; overflow-y: auto; }
  .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 6rem 2rem 4rem; }
  .dashboard-header { text-align: center; margin-bottom: 3rem; }
  .dashboard-title { font-family: 'Syne', sans-serif; font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 800; color: #fff; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
  .dashboard-subtitle { font-size: 0.85rem; color: var(--text-dim); letter-spacing: 0.08em; text-transform: uppercase; }
  .refresh-btn { display: inline-flex; align-items: center; gap: 0.5rem; margin: 2rem auto; padding: 0.8rem 1.6rem; background: var(--accent); color: var(--bg); border: none; border-radius: 6px; font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; cursor: pointer; transition: all 0.3s; }
  .refresh-btn:hover { box-shadow: 0 0 24px rgba(0,229,255,0.35); transform: translateY(-2px); }
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
  .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 2rem; transition: all 0.3s; position: relative; overflow: hidden; }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, var(--accent), var(--accent2)); opacity: 0; transition: opacity 0.3s; }
  .stat-card:hover { border-color: var(--accent); transform: translateY(-4px); box-shadow: 0 8px 32px rgba(0,229,255,0.1); }
  .stat-card:hover::before { opacity: 1; }
  .stat-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text-dim); margin-bottom: 0.8rem; }
  .stat-value { font-family: 'Syne', sans-serif; font-size: 3.5rem; font-weight: 800; color: var(--accent); line-height: 1; margin-bottom: 0.5rem; }
  .stat-change { font-size: 0.7rem; color: var(--text-dim); }
  .visitors-table { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 2rem; overflow-x: auto; }
  .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
  .table-title { font-family: 'Syne', sans-serif; font-size: 1.2rem; font-weight: 600; color: #fff; }
  .search-input { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 0.5rem 1rem; font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; color: var(--text); width: 250px; transition: all 0.3s; }
  .search-input:focus { outline: none; border-color: var(--accent); }
  table { width: 100%; border-collapse: collapse; }
  thead th { text-align: left; padding: 1rem; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-dim); border-bottom: 1px solid var(--border); font-weight: 600; }
  tbody td { padding: 1rem; font-size: 0.75rem; color: var(--text-dim); border-bottom: 1px solid var(--border); }
  tbody tr { transition: all 0.2s; }
  tbody tr:hover { background: var(--bg-card-hover); }
  .ip-badge { font-family: 'IBM Plex Mono', monospace; background: var(--accent-dim); color: var(--accent); padding: 0.25rem 0.6rem; border-radius: 4px; font-size: 0.7rem; }
  .time-ago { color: var(--text); }
  .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .empty-state { text-align: center; padding: 3rem 2rem; color: var(--text-dim); }
  .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.3; }
  .filter-tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
  .filter-tab { padding: 0.5rem 1rem; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; font-family: 'IBM Plex Mono', monospace; font-size: 0.7rem; color: var(--text-dim); cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.08em; }
  .filter-tab:hover { border-color: var(--accent); color: var(--accent); }
  .filter-tab.active { background: var(--accent-dim); border-color: var(--accent); color: var(--accent); }
  @media(max-width: 768px) {
    .dashboard-container { padding: 5rem 1.2rem 3rem; }
    .stats-grid { grid-template-columns: 1fr; }
    .search-input { width: 100%; }
  }
</style>
</head>
<body>

<nav>
  <a href="index.html" class="nav-logo">AA/</a>
  <div class="nav-links">
    <a href="index.html">Back to Portfolio</a>
  </div>
</nav>

<div class="dashboard-container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">Analytics Dashboard</h1>
    <p class="dashboard-subtitle">Portfolio Visitor Insights</p>
    <button class="refresh-btn" onclick="loadStats()">
      <span id="refreshIcon">ðŸ”„</span> Refresh Data
    </button>
  </div>

  <div id="loading" style="text-align: center; padding: 4rem 0; color: var(--text-dim);">
    <div class="loading-spinner" style="margin: 0 auto 1rem;"></div>
    <p>Loading analytics...</p>
  </div>

  <div id="dashboard" style="display: none;">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Visits</div>
        <div class="stat-value" id="totalVisits">0</div>
        <div class="stat-change">All-time page views</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">Unique Visitors</div>
        <div class="stat-value" id="uniqueVisitors">0</div>
        <div class="stat-change">Distinct IP addresses</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">Today's Visits</div>
        <div class="stat-value" id="visitsToday">0</div>
        <div class="stat-change">Last 24 hours</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-label">Avg. per Day</div>
        <div class="stat-value" id="avgPerDay">0</div>
        <div class="stat-change">Based on total data</div>
      </div>
    </div>

    <div class="visitors-table">
      <div class="table-header">
        <h2 class="table-title">Recent Visitors</h2>
        <input type="text" class="search-input" id="searchInput" placeholder="Search by IP or browser..." oninput="filterTable()" />
      </div>
      
      <div class="filter-tabs">
        <button class="filter-tab active" onclick="filterByTime('all')">All Time</button>
        <button class="filter-tab" onclick="filterByTime('today')">Today</button>
        <button class="filter-tab" onclick="filterByTime('week')">This Week</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Timestamp</th>
            <th>IP Address</th>
            <th>User Agent</th>
            <th>Time Ago</th>
          </tr>
        </thead>
        <tbody id="visitsTable"></tbody>
      </table>
      
      <div id="emptyState" style="display: none;" class="empty-state">
        <div class="empty-icon">ðŸ“Š</div>
        <p>No visitors yet. Share your portfolio to start tracking!</p>
      </div>
    </div>
  </div>
</div>

<script>
const API_URL = 'https://portfolio-8kk4.onrender.com';
let allVisits = [];
let filteredVisits = [];

function timeAgo(timestamp) {
  const now = new Date();
  const past = new Date(timestamp);
  const diffMs = now - past;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);
  
  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return `${diffMins}m ago`;
  if (diffHours < 24) return `${diffHours}h ago`;
  return `${diffDays}d ago`;
}

function truncate(str, maxLen) {
  return str.length <= maxLen ? str : str.substring(0, maxLen) + '...';
}

async function loadStats() {
  try {
    const refreshIcon = document.getElementById('refreshIcon');
    refreshIcon.style.animation = 'spin 0.8s linear infinite';
    
    document.getElementById('loading').style.display = 'block';
    document.getElementById('dashboard').style.display = 'none';
    
    const response = await fetch(`${API_URL}/api/stats`);
    const data = await response.json();
    
    document.getElementById('totalVisits').textContent = data.total_visits.toLocaleString();
    document.getElementById('uniqueVisitors').textContent = data.unique_visitors.toLocaleString();
    document.getElementById('visitsToday').textContent = data.visits_today.toLocaleString();
    
    if (data.visits.length > 0) {
      const firstVisit = new Date(data.visits[0].timestamp);
      const daysDiff = Math.max(1, Math.ceil((new Date() - firstVisit) / 86400000));
      document.getElementById('avgPerDay').textContent = Math.round(data.total_visits / daysDiff).toLocaleString();
    }
    
    allVisits = data.recent_visits.reverse();
    filteredVisits = [...allVisits];
    renderTable();
    
    document.getElementById('loading').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    refreshIcon.style.animation = '';
  } catch (error) {
    console.error('Error:', error);
    document.getElementById('loading').innerHTML = '<p style="color: #ff5f6b;">Error loading stats.</p>';
  }
}

function renderTable() {
  const tableBody = document.getElementById('visitsTable');
  const emptyState = document.getElementById('emptyState');
  
  if (filteredVisits.length === 0) {
    tableBody.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  tableBody.innerHTML = filteredVisits.map((visit, index) => `
    <tr>
      <td>${index + 1}</td>
      <td>${new Date(visit.timestamp).toLocaleString()}</td>
      <td><span class="ip-badge">${visit.ip}</span></td>
      <td>${truncate(visit.user_agent, 60)}</td>
      <td class="time-ago">${timeAgo(visit.timestamp)}</td>
    </tr>
  `).join('');
}

function filterTable() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  filteredVisits = searchTerm ? allVisits.filter(v => 
    v.ip.toLowerCase().includes(searchTerm) || v.user_agent.toLowerCase().includes(searchTerm)
  ) : [...allVisits];
  renderTable();
}

function filterByTime(period) {
  document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  
  const now = new Date();
  if (period === 'all') {
    filteredVisits = [...allVisits];
  } else if (period === 'today') {
    const todayStart = new Date(now.setHours(0,0,0,0));
    filteredVisits = allVisits.filter(v => new Date(v.timestamp) >= todayStart);
  } else if (period === 'week') {
    const weekAgo = new Date(now.getTime() - 7 * 86400000);
    filteredVisits = allVisits.filter(v => new Date(v.timestamp) >= weekAgo);
  }
  renderTable();
}

loadStats();
setInterval(loadStats, 30000);
</script>

</body>
</html>